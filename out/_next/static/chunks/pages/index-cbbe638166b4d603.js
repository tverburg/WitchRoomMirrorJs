(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[405],{5557:function(e,n,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return t(3313)}])},3313:function(e,n,t){"use strict";t.r(n),t.d(n,{default:function(){return y}});var o=t(5893),s=t(7294),i=t(89);let l=e=>{let{text:n}=e,t=n.split(" "),s={visible:{opacity:1,x:0,y:0,transition:{type:"spring",damping:12,stiffness:100}},hidden:{opacity:0,x:-20,y:10,transition:{type:"spring",damping:12,stiffness:100}}};return(0,o.jsx)(i.E.div,{style:{fontSize:"10rem",textAlign:"center"},variants:{hidden:{opacity:0},visible:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return{opacity:1,transition:{staggerChildren:.03,delayChildren:.04*e}}}},initial:"hidden",animate:"visible",children:t.map(e=>{let n=Array.from(e);return n.push(" "),(0,o.jsx)("span",{style:{display:"inline-block"},children:n.map((e,n)=>(0,o.jsx)(i.E.span,{variants:s,style:{display:"inline-block"},children:" "===e?"\xa0":e},n))})})})};var c=t(1285),r=t(4924),a=t(3070),u=t(1616),p={protocol:"websockets",username:"shape",password:"escape",keepalive:20,clientId:"mirrorApp"};class h{componentDidMount(){console.log("MqttService componentDidMount")}constructor(e){(0,r.Z)(this,"onConnect",()=>{console.log("mqtt connected"),this.client.subscribe("witchroom/mirror/#"),this.client.subscribe("witchroom/audio/#"),this.mirrorContext&&this.mirrorContext.setMqttConnected(!0)}),(0,r.Z)(this,"onOffline",()=>{console.log("mqtt offline"),this.mirrorContext&&this.mirrorContext.setMqttConnected(!1)}),(0,r.Z)(this,"handlePayload",e=>{let n;let t=e.toString();return console.log(t),(0,a.default)(t)?n=JSON.parse(t):(console.warn("A message was received in a non-json format:"),console.warn(t),n={msg:t}),console.log(n),n}),(0,r.Z)(this,"onMessageReceived",(e,n)=>{console.log(e,n);let t=e.substr(e.indexOf("/")+1);console.log(t);let o=this.handlePayload(n);this.mirrorContext.addReceivedMessage(o,t)}),console.log("MqttService construct"),console.log(e),this.client=u.connect("ws://localhost:8883",p),this.mirrorContext=e,this.client.on("connect",()=>{this.onConnect()}),this.client.on("offline",()=>{this.onOffline()}),this.client.on("message",(e,n)=>{console.log("onMessageReceived"),console.log(e,n),this.onMessageReceived(e,n)})}}var d=t(619),m=(0,s.memo)(function(e){let{playing:n,id:t,url:i,options:l}=e,[c,{stop:r}]=(0,d.Z)(i,l);return(0,s.useEffect)(()=>{console.log("AudioPlayer useEffect",n),0===n?(console.log("stop",t),r()):(console.log("play",t),c())},[n]),(0,o.jsx)(o.Fragment,{children:(0,o.jsx)("span",{})})},function(e,n){return e.playing===n.playing}),g=function(){(0,s.useContext)(c.N);let{audioMessages:e}=(0,s.useContext)(c.N),n="http://localhost:3000",t={backgroundMusicPhase1:{url:"".concat(n,"/bgm1.mp3"),options:{volume:.7}},backgroundMusicPhase2:{url:"".concat(n,"/bgm2.mp3"),options:{volume:.7}},backgroundMusicPhase3:{url:"".concat(n,"/bgm3.mp3"),options:{volume:.7}},hint:{url:"".concat(n,"/hint.mp3"),options:{volume:1}},thunder:{url:"".concat(n,"/thunder.mp3"),options:{volume:1}},witch:{url:"".concat(n,"/witch.mp3"),options:{volume:1}},rune:{url:"".concat(n,"/rune.mp3"),options:{volume:1}},runeSuccess:{url:"".concat(n,"/rune-success.mp3"),options:{volume:.7}},alchemy:{url:"".concat(n,"/alchemy.mp3"),options:{volume:1}},alchemySuccess:{url:"".concat(n,"/alchemy-success.mp3"),options:{volume:1}},flower:{url:"".concat(n,"/flower.mp3"),options:{volume:1}},finished:{url:"".concat(n,"/finished.mp3"),options:{volume:1}}},[i,l]=(0,s.useState)(0),[r,a]=(0,s.useState)(0),[u,p]=(0,s.useState)(0),[h,d]=(0,s.useState)(0),[g,f]=(0,s.useState)(0),[y,x]=(0,s.useState)(0),[b,v]=(0,s.useState)(0),[S,k]=(0,s.useState)(0),[w,j]=(0,s.useState)(0),[C,M]=(0,s.useState)(0),[P,N]=(0,s.useState)(0),[E,_]=(0,s.useState)(0);console.log("hintPlaying: ",h),(0,s.useEffect)(()=>{if(e){let n=e[e.length-1];n&&(console.log("select audio",n),O(n.payload))}},[e]);let O=e=>{let{type:n,action:t}=e;switch(n){case"bgm1":l(q(i,"play"===t));break;case"bgm2":a(q(r,"play"===t));break;case"bgm3":p(q(u,"play"===t));break;case"hint":d(q(h,"play"===t));break;case"witch":x(q(y,"play"===t));break;case"thunder":f(q(g,"play"===t));break;case"rune":v(q(b,"play"===t));break;case"runeSuccess":k(q(S,"play"===t));break;case"alchemy":j(q(w,"play"===t));break;case"alchemySuccess":M(q(C,"play"===t));break;case"flower":N(q(P,"play"===t));break;case"finished":_(q(E,"play"===t))}},q=(e,n)=>{let t=e+0;return n?++t:0};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(m,{id:"bmg1",playing:i,url:t.backgroundMusicPhase1.url,options:t.backgroundMusicPhase1.options}),(0,o.jsx)(m,{id:"bmg2",playing:r,url:t.backgroundMusicPhase2.url,options:t.backgroundMusicPhase2.options}),(0,o.jsx)(m,{id:"bmg3",playing:u,url:t.backgroundMusicPhase3.url,options:t.backgroundMusicPhase3.options}),(0,o.jsx)(m,{id:"hint",playing:h,url:t.hint.url,options:t.hint.options}),(0,o.jsx)(m,{id:"thunder",playing:g,url:t.thunder.url,options:t.thunder.options}),(0,o.jsx)(m,{id:"witch",playing:y,url:t.witch.url,options:t.witch.options}),(0,o.jsx)(m,{id:"rune",playing:b,url:t.rune.url,options:t.rune.options}),(0,o.jsx)(m,{id:"runeSuccess",playing:S,url:t.runeSuccess.url,options:t.runeSuccess.options}),(0,o.jsx)(m,{id:"alchemy",playing:w,url:t.alchemy.url,options:t.alchemy.options}),(0,o.jsx)(m,{id:"alchemySuccess",playing:C,url:t.alchemySuccess.url,options:t.alchemySuccess.options}),(0,o.jsx)(m,{id:"flower",playing:P,url:t.flower.url,options:t.flower.options}),(0,o.jsx)(m,{id:"finished",playing:E,url:t.finished.url,options:t.finished.options})]})};let f=()=>{let e=(0,s.useContext)(c.N),{messages:n}=(0,s.useContext)(c.N),[t,i]=(0,s.useState)(null);return console.log("Dashboard | ",n),(0,s.useEffect)(()=>{new h(e)},[]),(0,s.useEffect)(()=>{i(null);let e=setTimeout(()=>{i(n[n.length-1])},100);return()=>clearTimeout(e)},[n]),(0,o.jsxs)("div",{className:"grid",children:[(0,o.jsx)("div",{className:"col-12",children:(0,o.jsxs)("div",{className:"container h-screen mx-auto flex flex-col",style:{flexDirection:"column",alignItems:"center",justifyContent:"center"},children:[t&&(0,o.jsx)(l,{text:t}),(0,o.jsx)("div",{style:{textAlign:"center",fontSize:"10rem"},initial:"hidden",animate:"visible"})]})}),(0,o.jsx)(g,{})]})};var y=f},3070:function(e,n,t){"use strict";t.r(n),n.default=function(e){try{JSON.parse(e)}catch(e){return!1}return!0}},1784:function(){},5036:function(){},2361:function(){},4616:function(){}},function(e){e.O(0,[753,774,888,179],function(){return e(e.s=5557)}),_N_E=e.O()}]);